{
  "custompage": {
    "metadata": {
      "image": [],
      "title": "",
      "description": "",
      "keywords": ""
    },
    "algolia": {
      "recordCount": 8,
      "publishPending": false,
      "updatedAt": "2024-07-11T01:20:20.689Z"
    },
    "title": "Basic Semantic Search",
    "slug": "basic-semantic-search",
    "body": "[block:html]\n{\n  \"html\": \"<div class=\\\"cookbook-nav-container\\\">\\n  <a href=\\\"/page/cookbooks\\\" class=\\\"back-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_self\\\">\\n    <div class=\\\"pr-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"11.8\\\" height=\\\"11\\\" viewBox=\\\"0 0 14 13\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M1.1554 7.20808C1.35066 7.40335 1.66724 7.40335 1.8625 7.20808L7.18477 1.88582C7.38003 1.69055 7.38003 1.37397 7.18477 1.17871L6.83121 0.825157C6.63595 0.629895 6.31937 0.629896 6.12411 0.825157L0.801842 6.14742C0.60658 6.34269 0.60658 6.65927 0.801842 6.85453L1.1554 7.20808Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M1.1554 5.79226C1.35066 5.597 1.66724 5.597 1.8625 5.79226L7.18477 11.1145C7.38003 11.3098 7.38003 11.6264 7.18477 11.8216L6.83121 12.1752C6.63595 12.3705 6.31937 12.3705 6.12411 12.1752L0.801842 6.85292C0.60658 6.65766 0.60658 6.34108 0.801842 6.14582L1.1554 5.79226Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M2.52491 6.23674C2.52492 5.9606 2.74878 5.73675 3.02491 5.73675H6.28412C6.4513 5.73675 6.60742 5.8203 6.70015 5.95941L7.03347 6.45941C7.25499 6.79169 7.01679 7.23675 6.61745 7.23675H3.0249C2.74876 7.23675 2.5249 7.01289 2.5249 6.73674L2.52491 6.23674Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M13.5517 6.73676C13.5517 7.0129 13.3278 7.23675 13.0517 7.23675H8.79246C8.62528 7.23675 8.46916 7.1532 8.37643 7.0141L8.04311 6.5141C7.8216 6.18182 8.05979 5.73675 8.45914 5.73675H13.0517C13.3278 5.73675 13.5517 5.96062 13.5517 6.23676L13.5517 6.73676Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n    Back to Cookbooks\\n  </a>\\n\\n  <a href=https://github.com/cohere-ai/cohere-developer-experience/blob/main/notebooks/guides/Basic_Semantic_Search.ipynb class=\\\"github-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_blank\\\">\\n    Open in GitHub\\n    <div class=\\\"pl-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"14\\\" height=\\\"10\\\" viewBox=\\\"0 0 14 10\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M8.63218 0.366821C8.35604 0.366821 8.13218 0.590679 8.13218 0.866821V8.39364C8.13218 8.66978 8.35604 8.89364 8.63218 8.89364H9.13218C9.40832 8.89364 9.63218 8.66978 9.63218 8.39364V0.866821C9.63218 0.590678 9.40832 0.366821 9.13218 0.366821H8.63218Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M9.63332 1.36796C9.63332 1.6441 9.40946 1.86796 9.13332 1.86796H1.6065C1.33035 1.86796 1.1065 1.6441 1.1065 1.36796V0.867956C1.1065 0.591813 1.33035 0.367956 1.6065 0.367956H9.13332C9.40946 0.367956 9.63332 0.591813 9.63332 0.867956V1.36796Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M8.35063 2.02206C8.54588 2.21732 8.54588 2.5339 8.35062 2.72916L6.04601 5.03377C5.9278 5.15198 5.75833 5.20329 5.59439 5.1705L5.00515 5.05264C4.61356 4.97432 4.46728 4.49118 4.74966 4.2088L7.28997 1.66849C7.48523 1.47323 7.80182 1.47323 7.99708 1.6685L8.35063 2.02206Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M0.199967 9.46558C0.0047119 9.27032 0.0047151 8.95374 0.199974 8.75848L3.21169 5.74677C3.3299 5.62855 3.49938 5.57724 3.66331 5.61003L4.25256 5.72789C4.64414 5.80621 4.79042 6.28935 4.50804 6.57173L1.26063 9.81915C1.06536 10.0144 0.748774 10.0144 0.553513 9.81914L0.199967 9.46558Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n  </a>\\n</div>\\n\\n<div>\\n  <h1>Basic Semantic Search</h1>\\n</div>\\n\\n<style>\\n  .header {\\n    padding: 9px 0 17px 0;\\n    display: flex;\\n    flex-direction: column;\\n  }\\n\\n  a[href],\\n  .field-description a:not([href=\\\"\\\"]),\\n  .markdown-body a[href],\\n  .markdown-body a:not([href=\\\"\\\"]) {\\n    text-decoration: none;\\n  }\\n\\n  #content {\\n    padding: 0 32px;\\n  }\\n\\n  #content-head {\\n    display: none;\\n  }\\n\\n  .guide-page-title {\\n    font-size: 29px !important;\\n  }\\n\\n  .back-button .github-button {\\n    border-radius: 0 !important;\\n    border-width: 0 !important;\\n    background-color: inherit !important;\\n  }\\n\\n  .cookbook-nav-container {\\n    display: flex;\\n    flex-direction: row;\\n    justify-content: space-between;\\n    align-items: center;\\n  }\\n\\n  @media only screen and (min-width: 620px) {\\n    .guide-page-title {\\n      width: 70%;\\n    }\\n\\n    .header {\\n      display: flex;\\n      flex-direction: row;\\n      align-items: center;\\n      justify-content: space-between;\\n      padding: 9px 0 17px 0;\\n    }\\n\\n    .git--button {\\n      width: 145px !important;\\n      display: flex;\\n      flex-direction: row;\\n      justify-content: center;\\n      align-items: center;\\n      padding: 8px 16px;\\n\\n      width: 154px;\\n      height: 35px;\\n\\n      background: #D4D9D4;\\n      border: 1px solid #9DAAA4;\\n      border-radius: 6px;\\n    }\\n  }\\n\\n\\n  @media only screen and (min-width: 1024px) {\\n    .guide-page-title {\\n      font-size: 46px !important;\\n    }\\n\\n    .header {\\n      padding: 9px 0 32px 0;\\n    }\\n  }\\n</style>\"\n}\n[/block]\n\n\nLanguage models give computers the ability to search by meaning and go beyond searching by matching keywords. This capability is called semantic search. \n\n[block:html]\n{\n  \"html\": \"<img src=\\\"https://github.com/cohere-ai/cohere-developer-experience/raw/main/notebooks/images/basic-semantic-search-overview.png?3\\\" alt=\\\"Searching an archive using sentence embeddings\\\"/>\"\n}\n[/block]\n\n\nIn this notebook, we'll build a simple semantic search engine. The applications of semantic search go beyond building a web search engine. They can empower a private search engine for internal documents or records. It can also be used to power features like StackOverflow's \"similar questions\" feature.\n\n1. Get the archive of questions\n2. [Embed](https://docs.cohere.ai/embed-reference/) the archive\n3. Search using an index and nearest neighbor search\n4. Visualize the archive based on the embeddings \n\nAnd if you're running an older version of the SDK, you might need to upgrade it like so:\n\n```python\n#!pip install --upgrade cohere\n```\n\nGet your Cohere API key by [signing up here](https://os.cohere.ai/register). Paste it in the cell below.\n\n## 1. Getting Set Up\n\n```python\n#@title Import libraries (Run this cell to execute required code) {display-mode: \"form\"}\n\nimport cohere\nimport numpy as np\nimport re\nimport pandas as pd\nfrom tqdm import tqdm\nfrom datasets import load_dataset\nimport umap\nimport altair as alt\nfrom sklearn.metrics.pairwise import cosine_similarity\nfrom annoy import AnnoyIndex\nimport warnings\nwarnings.filterwarnings('ignore')\npd.set_option('display.max_colwidth', None)\n```\n\nYou'll need your API key for this next cell. [Sign up to Cohere](https://os.cohere.ai/) and get one if you haven't yet.\n\n```python\nmodel_name = \"embed-english-v3.0\"\napi_key = \"\"\ninput_type_embed = \"search_document\"\n\nco = cohere.Client(api_key)\n```\n\n## 2. Get The Archive of Questions\n\nWe'll use the [trec](https://www.tensorflow.org/datasets/catalog/trec) dataset which is made up of questions and their categories.\n\n```python\ndataset = load_dataset(\"trec\", split=\"train\")\n\ndf = pd.DataFrame(dataset)[:1000]\n\ndf.head(10)\n```\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n```\n.dataframe tbody tr th {\n    vertical-align: top;\n}\n\n.dataframe thead th {\n    text-align: right;\n}\n```\n\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>label-coarse</th>\n      <th>label-fine</th>\n      <th>text</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>0</td>\n      <td>How did serfdom develop in and then leave Russia ?</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1</td>\n      <td>What films featured the character Popeye Doyle ?</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0</td>\n      <td>How can I find a list of celebrities ' real names ?</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>2</td>\n      <td>What fowl grabs the spotlight after the Chinese Year of the Monkey ?</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2</td>\n      <td>3</td>\n      <td>What is the full form of .com ?</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>3</td>\n      <td>4</td>\n      <td>What contemptible scoundrel stole the cork from my lunch ?</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>3</td>\n      <td>5</td>\n      <td>What team did baseball 's St. Louis Browns become ?</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>3</td>\n      <td>6</td>\n      <td>What is the oldest profession ?</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0</td>\n      <td>7</td>\n      <td>What are liver enzymes ?</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>3</td>\n      <td>4</td>\n      <td>Name the scar-faced bounty hunter of The Old West .</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n## 2. Embed the archive\n\nThe next step is to embed the text of the questions.\n\n[block:html]\n{\n  \"html\": \"<img src=\\\"https://github.com/cohere-ai/cohere-developer-experience/raw/main/notebooks/images/semantic-search-embed-text-archive.png\\\" alt=\\\"embedding archive texts\\\"/>\"\n}\n[/block]\n\n\nTo get a thousand embeddings of this length should take about fifteen seconds.\n\n```python\nembeds = co.embed(texts=list(df['text']),\n                  model=model_name,\n                  input_type=input_type_embed).embeddings\n```\n\n```python\nembeds = np.array(embeds)\nembeds.shape\n```\n\n```\n(1000, 4096)\n```\n\n## 3. Search using an index and nearest neighbor search\n\n[block:html]\n{\n  \"html\": \"<img src=\\\"https://github.com/cohere-ai/cohere-developer-experience/raw/main/notebooks/images/semantic-search-index.png\\\" alt=\\\"Building the search index from the embeddings\\\"/>\"\n}\n[/block]\n\n\nLet's now use [Annoy](https://github.com/spotify/annoy) to build an index that stores the embeddings in a way that is optimized for fast search. This approach scales well to a large number of texts (other options include [Faiss](https://github.com/facebookresearch/faiss), [ScaNN](https://github.com/google-research/google-research/tree/master/scann), and [PyNNDescent](https://github.com/lmcinnes/pynndescent)).\n\nAfter building the index, we can use it to retrieve the nearest neighbors either of existing questions (section 3.1), or of new questions that we embed (section 3.2).\n\n```python\nsearch_index = AnnoyIndex(embeds.shape[1], 'angular')\nfor i in range(len(embeds)):\n    search_index.add_item(i, embeds[i])\n\nsearch_index.build(10) # 10 trees\nsearch_index.save('test.ann')\n```\n\n```\nTrue\n```\n\n### 3.1. Find the neighbors of an example from the dataset\n\nIf we're only interested in measuring the distance between the questions in the dataset (no outside queries), a simple way is to calculate the distance between every pair of embeddings we have.\n\n```python\nexample_id = 92\n\nsimilar_item_ids = search_index.get_nns_by_item(example_id,10,\n                                                include_distances=True)\nresults = pd.DataFrame(data={'texts': df.iloc[similar_item_ids[0]]['text'], \n                             'distance': similar_item_ids[1]}).drop(example_id)\n\nprint(f\"Question:'{df.iloc[example_id]['text']}'\\nNearest neighbors:\")\nresults\n```\n\n```\nQuestion:'What are bear and bull markets ?'\nNearest neighbors:\n```\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n```\n.dataframe tbody tr th {\n    vertical-align: top;\n}\n\n.dataframe thead th {\n    text-align: right;\n}\n```\n\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>texts</th>\n      <th>distance</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>614</th>\n      <td>What animals do you find in the stock market ?</td>\n      <td>0.904278</td>\n    </tr>\n    <tr>\n      <th>137</th>\n      <td>What are equity securities ?</td>\n      <td>0.992819</td>\n    </tr>\n    <tr>\n      <th>513</th>\n      <td>What do economists do ?</td>\n      <td>1.066583</td>\n    </tr>\n    <tr>\n      <th>307</th>\n      <td>What does NASDAQ stand for ?</td>\n      <td>1.080738</td>\n    </tr>\n    <tr>\n      <th>363</th>\n      <td>What does it mean `` Rupee Depreciates '' ?</td>\n      <td>1.086724</td>\n    </tr>\n    <tr>\n      <th>932</th>\n      <td>Why did the world enter a global depression in 1929 ?</td>\n      <td>1.099370</td>\n    </tr>\n    <tr>\n      <th>547</th>\n      <td>Where can stocks be traded on-line ?</td>\n      <td>1.105368</td>\n    </tr>\n    <tr>\n      <th>922</th>\n      <td>What is the difference between a median and a mean ?</td>\n      <td>1.141870</td>\n    </tr>\n    <tr>\n      <th>601</th>\n      <td>What is `` the bear of beers '' ?</td>\n      <td>1.154140</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n### 3.2. Find the neighbors of a user query\n\nWe're not limited to searching using existing items. If we get a query, we can embed it and find its nearest neighbors from the dataset.\n\n```python\nquery = \"What is the tallest mountain in the world?\"\ninput_type_query = \"search_query\"\n\nquery_embed = co.embed(texts=[query],\n                  model=model_name,\n                  input_type=input_type_query).embeddings\n\nsimilar_item_ids = search_index.get_nns_by_vector(query_embed[0],10,\n                                                include_distances=True)\nquery_results = pd.DataFrame(data={'texts': df.iloc[similar_item_ids[0]]['text'], \n                             'distance': similar_item_ids[1]})\n\n\nprint(f\"Query:'{query}'\\nNearest neighbors:\")\nprint(query_results) # NOTE: Your results might look slightly different to ours.\n```\n\n```\nQuery:'What is the tallest mountain in the world?'\nNearest neighbors:\n```\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n```\n.dataframe tbody tr th {\n    vertical-align: top;\n}\n\n.dataframe thead th {\n    text-align: right;\n}\n```\n\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>texts</th>\n      <th>distance</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>236</th>\n      <td>What is the name of the tallest mountain in the world ?</td>\n      <td>0.447309</td>\n    </tr>\n    <tr>\n      <th>670</th>\n      <td>What is the highest mountain in the world ?</td>\n      <td>0.552254</td>\n    </tr>\n    <tr>\n      <th>412</th>\n      <td>What was the highest mountain on earth before Mount Everest was discovered ?</td>\n      <td>0.801252</td>\n    </tr>\n    <tr>\n      <th>907</th>\n      <td>What mountain range is traversed by the highest railroad in the world ?</td>\n      <td>0.929516</td>\n    </tr>\n    <tr>\n      <th>435</th>\n      <td>What is the highest peak in Africa ?</td>\n      <td>0.930806</td>\n    </tr>\n    <tr>\n      <th>109</th>\n      <td>Where is the highest point in Japan ?</td>\n      <td>0.977315</td>\n    </tr>\n    <tr>\n      <th>901</th>\n      <td>What 's the longest river in the world ?</td>\n      <td>1.064209</td>\n    </tr>\n    <tr>\n      <th>114</th>\n      <td>What is the largest snake in the world ?</td>\n      <td>1.076390</td>\n    </tr>\n    <tr>\n      <th>962</th>\n      <td>What 's the second-largest island in the world ?</td>\n      <td>1.088034</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>What is the highest waterfall in the United States ?</td>\n      <td>1.091145</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n## 4. Visualizing the archive\n\nFinally, let's plot out all the questions onto a 2D chart so you're able to visualize the semantic similarities of this dataset!\n\n```python\n#@title Plot the archive {display-mode: \"form\"}\n\nreducer = umap.UMAP(n_neighbors=20) \numap_embeds = reducer.fit_transform(embeds)\ndf_explore = pd.DataFrame(data={'text': df['text']})\ndf_explore['x'] = umap_embeds[:,0]\ndf_explore['y'] = umap_embeds[:,1]\n\nchart = alt.Chart(df_explore).mark_circle(size=60).encode(\n    x=#'x',\n    alt.X('x',\n        scale=alt.Scale(zero=False)\n    ),\n    y=\n    alt.Y('y',\n        scale=alt.Scale(zero=False)\n    ),\n    tooltip=['text']\n).properties(\n    width=700,\n    height=400\n)\nchart.interactive()\n```\n\n<div id=\"altair-viz-1a157336aab148baac2f7b0488aa1e05\"></div>\n\nHover over the points to read the text. Do you see some of the patterns in clustered points? Similar questions, or questions asking about similar topics?\n\nThis concludes this introductory guide to semantic search using sentence embeddings. As you continue the path of building a search product additional considerations arise (like dealing with long texts, or finetuning to better improve the embeddings for a specific use case). \n\nWe can’t wait to see what you start building! Share your projects or find support on [Discord](https://discord.com/invite/co-mmunity).",
    "html": "",
    "htmlmode": false,
    "fullscreen": false,
    "hidden": true,
    "revision": 8,
    "_id": "664cbbcaeb0c1e0018f609b3",
    "__v": 0,
    "createdAt": "2024-05-21T15:20:42.618Z",
    "lastUpdatedHash": "87f6d0e9b3ede19bd66aa440992a49f55b1aff36",
    "project": "62cde2919aafea009aefb289",
    "updatedAt": "2024-07-11T01:20:20.689Z",
    "user": "63fcfa48e37787000ae6fbdd"
  },
  "meta": {
    "user": {
      "allowedProjects": ["cohere-ai", "cohere-enterprise"],
      "apiKey": "",
      "email": "andrewjiang@hey.com",
      "name": "Andrew Jiang",
      "version": 1,
      "Name": "Andrew Jiang",
      "Email": "andrewjiang@hey.com",
      "APIKey": "",
      "AllowedProjects": ["cohere-ai", "cohere-enterprise"]
    },
    "baseUrl": "/",
    "hidden": true,
    "title": "Basic Semantic Search",
    "metaTitle": "Basic Semantic Search",
    "keywords": "",
    "description": "",
    "image": [],
    "slug": "basic-semantic-search",
    "type": "custompage",
    "full": false
  }
}
