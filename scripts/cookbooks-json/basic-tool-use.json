{
  "custompage": {
    "metadata": {
      "image": [],
      "title": "",
      "description": "",
      "keywords": ""
    },
    "algolia": {
      "recordCount": 7,
      "publishPending": false,
      "updatedAt": "2024-07-11T01:20:28.040Z"
    },
    "title": "Basic Tool Use",
    "slug": "basic-tool-use",
    "body": "[block:html]\n{\n  \"html\": \"<div class=\\\"cookbook-nav-container\\\">\\n  <a href=\\\"/page/cookbooks\\\" class=\\\"back-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_self\\\">\\n    <div class=\\\"pr-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"11.8\\\" height=\\\"11\\\" viewBox=\\\"0 0 14 13\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M1.1554 7.20808C1.35066 7.40335 1.66724 7.40335 1.8625 7.20808L7.18477 1.88582C7.38003 1.69055 7.38003 1.37397 7.18477 1.17871L6.83121 0.825157C6.63595 0.629895 6.31937 0.629896 6.12411 0.825157L0.801842 6.14742C0.60658 6.34269 0.60658 6.65927 0.801842 6.85453L1.1554 7.20808Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M1.1554 5.79226C1.35066 5.597 1.66724 5.597 1.8625 5.79226L7.18477 11.1145C7.38003 11.3098 7.38003 11.6264 7.18477 11.8216L6.83121 12.1752C6.63595 12.3705 6.31937 12.3705 6.12411 12.1752L0.801842 6.85292C0.60658 6.65766 0.60658 6.34108 0.801842 6.14582L1.1554 5.79226Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M2.52491 6.23674C2.52492 5.9606 2.74878 5.73675 3.02491 5.73675H6.28412C6.4513 5.73675 6.60742 5.8203 6.70015 5.95941L7.03347 6.45941C7.25499 6.79169 7.01679 7.23675 6.61745 7.23675H3.0249C2.74876 7.23675 2.5249 7.01289 2.5249 6.73674L2.52491 6.23674Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M13.5517 6.73676C13.5517 7.0129 13.3278 7.23675 13.0517 7.23675H8.79246C8.62528 7.23675 8.46916 7.1532 8.37643 7.0141L8.04311 6.5141C7.8216 6.18182 8.05979 5.73675 8.45914 5.73675H13.0517C13.3278 5.73675 13.5517 5.96062 13.5517 6.23676L13.5517 6.73676Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n    Back to Cookbooks\\n  </a>\\n\\n  <a href=https://github.com/cohere-ai/notebooks/blob/main/notebooks/agents/Vanilla_Tool_Use.ipynb class=\\\"github-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_blank\\\">\\n    Open in GitHub\\n    <div class=\\\"pl-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"14\\\" height=\\\"10\\\" viewBox=\\\"0 0 14 10\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M8.63218 0.366821C8.35604 0.366821 8.13218 0.590679 8.13218 0.866821V8.39364C8.13218 8.66978 8.35604 8.89364 8.63218 8.89364H9.13218C9.40832 8.89364 9.63218 8.66978 9.63218 8.39364V0.866821C9.63218 0.590678 9.40832 0.366821 9.13218 0.366821H8.63218Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M9.63332 1.36796C9.63332 1.6441 9.40946 1.86796 9.13332 1.86796H1.6065C1.33035 1.86796 1.1065 1.6441 1.1065 1.36796V0.867956C1.1065 0.591813 1.33035 0.367956 1.6065 0.367956H9.13332C9.40946 0.367956 9.63332 0.591813 9.63332 0.867956V1.36796Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M8.35063 2.02206C8.54588 2.21732 8.54588 2.5339 8.35062 2.72916L6.04601 5.03377C5.9278 5.15198 5.75833 5.20329 5.59439 5.1705L5.00515 5.05264C4.61356 4.97432 4.46728 4.49118 4.74966 4.2088L7.28997 1.66849C7.48523 1.47323 7.80182 1.47323 7.99708 1.6685L8.35063 2.02206Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M0.199967 9.46558C0.0047119 9.27032 0.0047151 8.95374 0.199974 8.75848L3.21169 5.74677C3.3299 5.62855 3.49938 5.57724 3.66331 5.61003L4.25256 5.72789C4.64414 5.80621 4.79042 6.28935 4.50804 6.57173L1.26063 9.81915C1.06536 10.0144 0.748774 10.0144 0.553513 9.81914L0.199967 9.46558Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n  </a>\\n</div>\\n\\n<div>\\n  <h1>Basic Tool Use</h1>\\n</div>\\n\\n<style>\\n  .header {\\n    padding: 9px 0 17px 0;\\n    display: flex;\\n    flex-direction: column;\\n  }\\n\\n  a[href],\\n  .field-description a:not([href=\\\"\\\"]),\\n  .markdown-body a[href],\\n  .markdown-body a:not([href=\\\"\\\"]) {\\n    text-decoration: none;\\n  }\\n\\n  #content {\\n    padding: 0 32px;\\n  }\\n\\n  #content-head {\\n    display: none;\\n  }\\n\\n  .guide-page-title {\\n    font-size: 29px !important;\\n  }\\n\\n  .back-button .github-button {\\n    border-radius: 0 !important;\\n    border-width: 0 !important;\\n    background-color: inherit !important;\\n  }\\n\\n  .cookbook-nav-container {\\n    display: flex;\\n    flex-direction: row;\\n    justify-content: space-between;\\n    align-items: center;\\n  }\\n\\n  @media only screen and (min-width: 620px) {\\n    .guide-page-title {\\n      width: 70%;\\n    }\\n\\n    .header {\\n      display: flex;\\n      flex-direction: row;\\n      align-items: center;\\n      justify-content: space-between;\\n      padding: 9px 0 17px 0;\\n    }\\n\\n    .git--button {\\n      width: 145px !important;\\n      display: flex;\\n      flex-direction: row;\\n      justify-content: center;\\n      align-items: center;\\n      padding: 8px 16px;\\n\\n      width: 154px;\\n      height: 35px;\\n\\n      background: #D4D9D4;\\n      border: 1px solid #9DAAA4;\\n      border-radius: 6px;\\n    }\\n  }\\n\\n\\n  @media only screen and (min-width: 1024px) {\\n    .guide-page-title {\\n      font-size: 46px !important;\\n    }\\n\\n    .header {\\n      padding: 9px 0 32px 0;\\n    }\\n  }\\n</style>\"\n}\n[/block]\n\n\nTool use allows customers to **connect their large language models to external tools, such as search engines, APIs, functions, and databases**.\n\nThis allows the customer to unlock a richer set of model behaviors by, for instance, leveraging data stored in tools, taking actions through APIs, interacting with a vector database, or querying a search engine.\n\nBelow, we illustrate tool use in four steps:\n\n- Step 1: the user configures the request to the model\n- Step 2: the model uses context to **determine which tool(s) to use and how**\n- Step 3: the tool calls are executed\n- Step 4: the model **generates a final answer with precise citations** based on the tool results\n\n```python\nimport cohere, json\nAPI_KEY = \"...\" # fill in your Cohere API key here\nco = cohere.Client(API_KEY)\n```\n\n## Step 0: Create a mock database\n\nBefore we can illustrate tool use, we first need to do some setup. Here, we'll define the mock data that our tools will query. This data represents sales reports and a product catalog.\n\n```python\nsales_database = {\n    '2023-09-28': {\n        'total_sales_amount': 5000,\n        'total_units_sold': 100,\n    },\n    '2023-09-29': {\n        'total_sales_amount': 10000,\n        'total_units_sold': 250,\n    },\n    '2023-09-30': {\n        'total_sales_amount': 8000,\n        'total_units_sold': 200,\n    }\n}\n\nproduct_catalog = {\n    'Electronics': [\n        {'product_id': 'E1001', 'name': 'Smartphone', 'price': 500, 'stock_level': 20},\n        {'product_id': 'E1002', 'name': 'Laptop', 'price': 1000, 'stock_level': 15},\n        {'product_id': 'E1003', 'name': 'Tablet', 'price': 300, 'stock_level': 25},\n    ],\n    'Clothing': [\n        {'product_id': 'C1001', 'name': 'T-Shirt', 'price': 20, 'stock_level': 100},\n        {'product_id': 'C1002', 'name': 'Jeans', 'price': 50, 'stock_level': 80},\n        {'product_id': 'C1003', 'name': 'Jacket', 'price': 100, 'stock_level': 40},\n    ]\n}\n```\n\nNow, we'll define the tools that simulate querying this database.  \nFor example, you could use the API of an enterprise sales platform.\n\n```python\ndef query_daily_sales_report(day: str) -> dict:\n    \"\"\"\n    Function to retrieve the sales report for the given day\n    \"\"\"\n    report = sales_database.get(day, {})\n    if report:\n        return {\n            'date': day,\n            'summary': f\"Total Sales Amount: {report['total_sales_amount']}, Total Units Sold: {report['total_units_sold']}\"\n        }\n    else:\n        return {'date': day, 'summary': 'No sales data available for this day.'}\n\n\ndef query_product_catalog(category: str) -> dict:\n    \"\"\"\n    Function to retrieve products for the given category\n    \"\"\"\n    products = product_catalog.get(category, [])\n    return {\n        'category': category,\n        'products': products\n    }\n\n\nfunctions_map = {\n    \"query_daily_sales_report\": query_daily_sales_report,\n    \"query_product_catalog\": query_product_catalog\n}\n```\n\n## Step 1 - User configures the request to the model\n\nThe developer provides a few things to the model:\n\n- A preamble containing instructions about the task and the desired style for the output.\n- The user request.\n- A list of tools to the model.\n- (Optionally) a chat history for the model to work with.\n\nYou can specify one or many tools to the model. Every tool needs to be described with a JSON schema, indicating the tool name, description, and parameters (code snippets below).\n\nIn our example, we provide two tools to the model: `daily_sales_report` and `product_catalog`.\n\n```python\ntools = [\n    {\n        \"name\": \"query_daily_sales_report\",\n        \"description\": \"Connects to a database to retrieve overall sales volumes and sales information for a given day.\",\n        \"parameter_definitions\": {\n            \"day\": {\n                \"description\": \"Retrieves sales data for this day, formatted as YYYY-MM-DD.\",\n                \"type\": \"str\",\n                \"required\": True\n            }\n        }\n    },\n    {\n        \"name\": \"query_product_catalog\",\n        \"description\": \"Connects to a a product catalog with information about all the products being sold, including categories, prices, and stock levels.\",\n        \"parameter_definitions\": {\n            \"category\": {\n                \"description\": \"Retrieves product information data for all products in this category.\",\n                \"type\": \"str\",\n                \"required\": True\n            }\n        }\n    }\n]\n```\n\nNow let's define the user request.  \n\nIn our example we'll use: \"Can you provide a sales summary for 29th September 2023, and also give me the details of all products in the 'Electronics' category that were sold that day, including their prices and stock levels?\"\n\nOnly a langage model with Tool Use can answer this request: it requires looking up information in the right external tools (step 2), and then providing a final answer based on the tool results (step 4).\n\n```python\npreamble = \"\"\"\n## Task & Context\nYou help people answer their questions and other requests interactively. You will be asked a very wide array of requests on all kinds of topics. You will be equipped with a wide range of search engines or similar tools to help you, which you use to research your answer. You should focus on serving the user's needs as best you can, which will be wide-ranging.\n\n## Style Guide\nUnless the user asks for a different style of answer, you should answer in full sentences, using proper grammar and spelling.\n\"\"\"\n\nmessage = \"Can you provide a sales summary for 29th September 2023, and also give me some details about the products in the 'Electronics' category, for example their prices and stock levels?\"\n```\n\n## Step 2 â€“ The model smartly decides which tool(s) to use and how\n\nThe model intelligently selects the right tool(s) to call -- and the right parameters for each tool call -- based on the content of the user message.\n\n```python\nresponse = co.chat(\n    message=message,\n    tools=tools,\n    preamble=preamble,\n    model=\"command-r\"\n)\n\n\nprint(\"The model recommends doing the following tool calls:\")\nprint(\"\\n\".join(str(tool_call) for tool_call in response.tool_calls))\n```\n\n```\nThe model recommends doing the following tool calls:\ncohere.ToolCall {\n\tname: query_daily_sales_report\n\tparameters: {'day': '2023-09-29'}\n\tgeneration_id: eaf955e3-623d-4796-bf51-23b07c66ed2c\n}\ncohere.ToolCall {\n\tname: query_product_catalog\n\tparameters: {'category': 'Electronics'}\n\tgeneration_id: eaf955e3-623d-4796-bf51-23b07c66ed2c\n}\n```\n\n## Step 3 â€“ The tool calls are executed\n\nYou can now execute the appropriate calls, using the tool calls and tool parameters generated by the model.  \nThese tool calls return tool results that will be fed to the model in Step 4.\n\n```python\ntool_results = []\nfor tool_call in response.tool_calls:\n    # here is where you would call the tool recommended by the model, using the parameters recommended by the model\n    print(f\"= running tool {tool_call.name}, with parameters: {tool_call.parameters}\")\n    output = functions_map[tool_call.name](**tool_call.parameters)\n    # store the output in a list\n    outputs = [output]\n    print(f\"== tool results: {outputs}\")\n    # store your tool results in this format\n    tool_results.append({\n        \"call\": tool_call,\n        \"outputs\": outputs\n    })\n\nprint(\"Tool results that will be fed back to the model in step 4:\")\nprint(json.dumps(tool_results, indent=4))\n```\n\n```\n= running tool query_daily_sales_report, with parameters: {'day': '2023-09-29'}\n== tool results: [{'date': '2023-09-29', 'summary': 'Total Sales Amount: 10000, Total Units Sold: 250'}]\n= running tool query_product_catalog, with parameters: {'category': 'Electronics'}\n== tool results: [{'category': 'Electronics', 'products': [{'product_id': 'E1001', 'name': 'Smartphone', 'price': 500, 'stock_level': 20}, {'product_id': 'E1002', 'name': 'Laptop', 'price': 1000, 'stock_level': 15}, {'product_id': 'E1003', 'name': 'Tablet', 'price': 300, 'stock_level': 25}]}]\nTool results that will be fed back to the model in step 4:\n[\n    {\n        \"call\": {\n            \"name\": \"query_daily_sales_report\",\n            \"parameters\": {\n                \"day\": \"2023-09-29\"\n            },\n            \"generation_id\": \"eaf955e3-623d-4796-bf51-23b07c66ed2c\"\n        },\n        \"outputs\": [\n            {\n                \"date\": \"2023-09-29\",\n                \"summary\": \"Total Sales Amount: 10000, Total Units Sold: 250\"\n            }\n        ]\n    },\n    {\n        \"call\": {\n            \"name\": \"query_product_catalog\",\n            \"parameters\": {\n                \"category\": \"Electronics\"\n            },\n            \"generation_id\": \"eaf955e3-623d-4796-bf51-23b07c66ed2c\"\n        },\n        \"outputs\": [\n            {\n                \"category\": \"Electronics\",\n                \"products\": [\n                    {\n                        \"product_id\": \"E1001\",\n                        \"name\": \"Smartphone\",\n                        \"price\": 500,\n                        \"stock_level\": 20\n                    },\n                    {\n                        \"product_id\": \"E1002\",\n                        \"name\": \"Laptop\",\n                        \"price\": 1000,\n                        \"stock_level\": 15\n                    },\n                    {\n                        \"product_id\": \"E1003\",\n                        \"name\": \"Tablet\",\n                        \"price\": 300,\n                        \"stock_level\": 25\n                    }\n                ]\n            }\n        ]\n    }\n]\n```\n\n## Step 4 - The model generates a final answer based on the tool results\n\nFinally, the developer calls the Cohere model, providing the tools results, in order to generate the model's final answer.  \n\n```python\nresponse = co.chat(\n    message=message,\n    tools=tools,\n    tool_results=tool_results,\n    preamble=preamble,\n    model=\"command-r\",\n    temperature=0.3\n)\n```\n\n```python\nprint(\"Final answer:\")\nprint(response.text)\n```\n\n```\nFinal answer:\nOn the 29th of September 2023, there were 10,000 sales with 250 units sold. \n\nThe Electronics category contains three products. There are details below:\n\n| Product Name | Price | Stock Level |\n| ------------ | ----- | ----------- |\n| Smartphone | 500 | 20 |\n| Laptop | 1000 | 15 |\n| Tablet | 300 | 25 | \n\nThe total stock level for Electronics items is 50.\n```\n\n## Bonus: Citations come for free with Cohere! ðŸŽ‰\n\nAt Cohere, model generations come with... precise citations! ðŸŽ‰  \nThe model cites which groups of words, in the tool results, were used to generate the final answer.  \nThese citations make it easy to check where the modelâ€™s generated response claims are coming from.  \nThey help users gain visibility into the model reasoning, and sanity check the final model generation.  \nThese citations are optional â€” you can decide to ignore them.\n\n```python\nprint(\"Citations that support the final answer:\")\nfor cite in response.citations:\n  print(cite)\n```\n\n```\nCitations that support the final answer:\n{'start': 7, 'end': 29, 'text': '29th of September 2023', 'document_ids': ['query_daily_sales_report:0:0']}\n{'start': 42, 'end': 75, 'text': '10,000 sales with 250 units sold.', 'document_ids': ['query_daily_sales_report:0:0']}\n{'start': 112, 'end': 127, 'text': 'three products.', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 234, 'end': 244, 'text': 'Smartphone', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 247, 'end': 250, 'text': '500', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 253, 'end': 255, 'text': '20', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 260, 'end': 266, 'text': 'Laptop', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 269, 'end': 273, 'text': '1000', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 276, 'end': 278, 'text': '15', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 283, 'end': 289, 'text': 'Tablet', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 292, 'end': 295, 'text': '300', 'document_ids': ['query_product_catalog:1:0']}\n{'start': 298, 'end': 300, 'text': '25', 'document_ids': ['query_product_catalog:1:0']}\n```\n\n```python\ndef insert_citations_in_order(text, citations):\n    \"\"\"\n    A helper function to pretty print citations.\n    \"\"\"\n    offset = 0\n    document_id_to_number = {}\n    citation_number = 0\n    modified_citations = []\n\n    # Process citations, assigning numbers based on unique document_ids\n    for citation in citations:\n        citation_numbers = []\n        for document_id in sorted(citation[\"document_ids\"]):\n            if document_id not in document_id_to_number:\n                citation_number += 1  # Increment for a new document_id\n                document_id_to_number[document_id] = citation_number\n            citation_numbers.append(document_id_to_number[document_id])\n\n        # Adjust start/end with offset\n        start, end = citation['start'] + offset, citation['end'] + offset\n        placeholder = ''.join([f'[{number}]' for number in citation_numbers])\n        # Bold the cited text and append the placeholder\n        modification = f'**{text[start:end]}**{placeholder}'\n        # Replace the cited text with its bolded version + placeholder\n        text = text[:start] + modification + text[end:]\n        # Update the offset for subsequent replacements\n        offset += len(modification) - (end - start)\n\n    # Prepare citations for listing at the bottom, ensuring unique document_ids are listed once\n    unique_citations = {number: doc_id for doc_id, number in document_id_to_number.items()}\n    citation_list = '\\n'.join([f'[{doc_id}] source: {tool_results[doc_id - 1][\"outputs\"]} \\n    based on tool call: {dict(tool_results[doc_id - 1][\"call\"])}' for doc_id, number in sorted(unique_citations.items(), key=lambda item: item[1])])\n    text_with_citations = f'{text}\\n\\n{citation_list}'\n\n    return text_with_citations\n\n\nprint(insert_citations_in_order(response.text, response.citations))\n\n```\n\n```\nOn the **29th of September 2023**[1], there were **10,000 sales with 250 units sold.**[1] \n\nThe Electronics category contains **three products.**[2] There are details below:\n\n| Product Name | Price | Stock Level |\n| ------------ | ----- | ----------- |\n| **Smartphone**[2] | **500**[2] | **20**[2] |\n| **Laptop**[2] | **1000**[2] | **15**[2] |\n| **Tablet**[2] | **300**[2] | **25**[2] | \n\nThe total stock level for Electronics items is 50.\n\n[1] source: [{'date': '2023-09-29', 'summary': 'Total Sales Amount: 10000, Total Units Sold: 250'}] \n    based on tool call: {'name': 'query_daily_sales_report', 'parameters': {'day': '2023-09-29'}, 'generation_id': 'eaf955e3-623d-4796-bf51-23b07c66ed2c'}\n[2] source: [{'category': 'Electronics', 'products': [{'product_id': 'E1001', 'name': 'Smartphone', 'price': 500, 'stock_level': 20}, {'product_id': 'E1002', 'name': 'Laptop', 'price': 1000, 'stock_level': 15}, {'product_id': 'E1003', 'name': 'Tablet', 'price': 300, 'stock_level': 25}]}] \n    based on tool call: {'name': 'query_product_catalog', 'parameters': {'category': 'Electronics'}, 'generation_id': 'eaf955e3-623d-4796-bf51-23b07c66ed2c'}\n```\n\nNow, you've used Cohere for Tool Use.  Tool use opens up a wide range of new use cases. Here are a few examples:\n\n- **Function calling**: It's now possible to ask the model to output a JSON object with specific function parameters.  \n  For instance, this allows your chatbot to interact with your CRM to change the status of a deal, or to engage with a Python interpreter to conduct data science analyses.\n\n- **Query transformation**: You can transform a user message into a search query for a vector database or any search engine.  \n  For instance, this enables your work assistant to automatically retrieve the appropriate data from your company's documentation by creating the right query for your vector database.\n\n- **Advanced searches**: You can transform a user message into one-or-many queries, to do multiple subtasks based on the content of the message.  \n  For instance, this allows your chatbot to search across different databases and platforms to retrieve relevant information or to conduct comparative analysis.",
    "html": "",
    "htmlmode": false,
    "fullscreen": false,
    "hidden": true,
    "revision": 8,
    "_id": "664dc8f8e83c76002b63732d",
    "__v": 0,
    "createdAt": "2024-05-22T10:29:12.245Z",
    "lastUpdatedHash": "104327a0f8a6dc31a4448aa1f75a870bd962bfca",
    "project": "62cde2919aafea009aefb289",
    "updatedAt": "2024-07-11T01:20:28.040Z",
    "user": "63fcfa48e37787000ae6fbdd"
  },
  "meta": {
    "user": {
      "allowedProjects": ["cohere-ai", "cohere-enterprise"],
      "apiKey": "",
      "email": "andrewjiang@hey.com",
      "name": "Andrew Jiang",
      "version": 1,
      "Name": "Andrew Jiang",
      "Email": "andrewjiang@hey.com",
      "APIKey": "",
      "AllowedProjects": ["cohere-ai", "cohere-enterprise"]
    },
    "baseUrl": "/",
    "hidden": true,
    "title": "Basic Tool Use",
    "metaTitle": "Basic Tool Use",
    "keywords": "",
    "description": "",
    "image": [],
    "slug": "basic-tool-use",
    "type": "custompage",
    "full": false
  }
}
