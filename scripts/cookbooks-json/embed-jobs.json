{
  "custompage": {
    "metadata": {
      "image": [],
      "title": "",
      "description": "",
      "keywords": ""
    },
    "algolia": {
      "recordCount": 7,
      "publishPending": false,
      "updatedAt": "2024-07-11T01:20:27.241Z"
    },
    "title": "Semantic Search with Cohere Embed Jobs",
    "slug": "embed-jobs",
    "body": "[block:html]\n{\n  \"html\": \"<div class=\\\"cookbook-nav-container\\\">\\n  <a href=\\\"/page/cookbooks\\\" class=\\\"back-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_self\\\">\\n    <div class=\\\"pr-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"11.8\\\" height=\\\"11\\\" viewBox=\\\"0 0 14 13\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M1.1554 7.20808C1.35066 7.40335 1.66724 7.40335 1.8625 7.20808L7.18477 1.88582C7.38003 1.69055 7.38003 1.37397 7.18477 1.17871L6.83121 0.825157C6.63595 0.629895 6.31937 0.629896 6.12411 0.825157L0.801842 6.14742C0.60658 6.34269 0.60658 6.65927 0.801842 6.85453L1.1554 7.20808Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M1.1554 5.79226C1.35066 5.597 1.66724 5.597 1.8625 5.79226L7.18477 11.1145C7.38003 11.3098 7.38003 11.6264 7.18477 11.8216L6.83121 12.1752C6.63595 12.3705 6.31937 12.3705 6.12411 12.1752L0.801842 6.85292C0.60658 6.65766 0.60658 6.34108 0.801842 6.14582L1.1554 5.79226Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M2.52491 6.23674C2.52492 5.9606 2.74878 5.73675 3.02491 5.73675H6.28412C6.4513 5.73675 6.60742 5.8203 6.70015 5.95941L7.03347 6.45941C7.25499 6.79169 7.01679 7.23675 6.61745 7.23675H3.0249C2.74876 7.23675 2.5249 7.01289 2.5249 6.73674L2.52491 6.23674Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M13.5517 6.73676C13.5517 7.0129 13.3278 7.23675 13.0517 7.23675H8.79246C8.62528 7.23675 8.46916 7.1532 8.37643 7.0141L8.04311 6.5141C7.8216 6.18182 8.05979 5.73675 8.45914 5.73675H13.0517C13.3278 5.73675 13.5517 5.96062 13.5517 6.23676L13.5517 6.73676Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n    Back to Cookbooks\\n  </a>\\n\\n  <a href=https://github.com/cohere-ai/notebooks/blob/main/notebooks/Embed_Jobs_Semantic_Search.ipynb class=\\\"github-button pt-10 group inline-block cursor-pointer font-medium \\\" rel=\\\"noreferrer\\\"\\n    target=\\\"_blank\\\">\\n    Open in GitHub\\n    <div class=\\\"pl-1 inline-block group-hover:no-underline\\\">\\n      <svg width=\\\"14\\\" height=\\\"10\\\" viewBox=\\\"0 0 14 10\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n        <path\\n          d=\\\"M8.63218 0.366821C8.35604 0.366821 8.13218 0.590679 8.13218 0.866821V8.39364C8.13218 8.66978 8.35604 8.89364 8.63218 8.89364H9.13218C9.40832 8.89364 9.63218 8.66978 9.63218 8.39364V0.866821C9.63218 0.590678 9.40832 0.366821 9.13218 0.366821H8.63218Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M9.63332 1.36796C9.63332 1.6441 9.40946 1.86796 9.13332 1.86796H1.6065C1.33035 1.86796 1.1065 1.6441 1.1065 1.36796V0.867956C1.1065 0.591813 1.33035 0.367956 1.6065 0.367956H9.13332C9.40946 0.367956 9.63332 0.591813 9.63332 0.867956V1.36796Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M8.35063 2.02206C8.54588 2.21732 8.54588 2.5339 8.35062 2.72916L6.04601 5.03377C5.9278 5.15198 5.75833 5.20329 5.59439 5.1705L5.00515 5.05264C4.61356 4.97432 4.46728 4.49118 4.74966 4.2088L7.28997 1.66849C7.48523 1.47323 7.80182 1.47323 7.99708 1.6685L8.35063 2.02206Z\\\"\\n          fill=\\\"currentColor\\\" />\\n        <path\\n          d=\\\"M0.199967 9.46558C0.0047119 9.27032 0.0047151 8.95374 0.199974 8.75848L3.21169 5.74677C3.3299 5.62855 3.49938 5.57724 3.66331 5.61003L4.25256 5.72789C4.64414 5.80621 4.79042 6.28935 4.50804 6.57173L1.26063 9.81915C1.06536 10.0144 0.748774 10.0144 0.553513 9.81914L0.199967 9.46558Z\\\"\\n          fill=\\\"currentColor\\\" />\\n      </svg>\\n    </div>\\n  </a>\\n</div>\\n\\n<div>\\n  <h1>Semantic Search with Cohere Embed Jobs</h1>\\n</div>\\n\\n<style>\\n  .header {\\n    padding: 9px 0 17px 0;\\n    display: flex;\\n    flex-direction: column;\\n  }\\n\\n  a[href],\\n  .field-description a:not([href=\\\"\\\"]),\\n  .markdown-body a[href],\\n  .markdown-body a:not([href=\\\"\\\"]) {\\n    text-decoration: none;\\n  }\\n\\n  #content {\\n    padding: 0 32px;\\n  }\\n\\n  #content-head {\\n    display: none;\\n  }\\n\\n  .guide-page-title {\\n    font-size: 29px !important;\\n  }\\n\\n  .back-button .github-button {\\n    border-radius: 0 !important;\\n    border-width: 0 !important;\\n    background-color: inherit !important;\\n  }\\n\\n  .cookbook-nav-container {\\n    display: flex;\\n    flex-direction: row;\\n    justify-content: space-between;\\n    align-items: center;\\n  }\\n\\n  @media only screen and (min-width: 620px) {\\n    .guide-page-title {\\n      width: 70%;\\n    }\\n\\n    .header {\\n      display: flex;\\n      flex-direction: row;\\n      align-items: center;\\n      justify-content: space-between;\\n      padding: 9px 0 17px 0;\\n    }\\n\\n    .git--button {\\n      width: 145px !important;\\n      display: flex;\\n      flex-direction: row;\\n      justify-content: center;\\n      align-items: center;\\n      padding: 8px 16px;\\n\\n      width: 154px;\\n      height: 35px;\\n\\n      background: #D4D9D4;\\n      border: 1px solid #9DAAA4;\\n      border-radius: 6px;\\n    }\\n  }\\n\\n\\n  @media only screen and (min-width: 1024px) {\\n    .guide-page-title {\\n      font-size: 46px !important;\\n    }\\n\\n    .header {\\n      padding: 9px 0 32px 0;\\n    }\\n  }\\n</style>\"\n}\n[/block]\n\n\n\n```python\nimport time\nimport cohere\nimport hnswlib\nco = cohere.Client('COHERE_API_KEY')\n```\n\n## Step 1: Upload a dataset\n\n\n```python\n\ndataset_file_path = \"data/embed_jobs_sample_data.jsonl\" # Full path - https://raw.githubusercontent.com/cohere-ai/notebooks/main/notebooks/data/embed_jobs_sample_data.jsonl\n\nds=co.create_dataset(\n\tname='sample_file',\n\tdata=open(dataset_file_path, 'rb'),\n\tkeep_fields = ['id','wiki_id'],\n\tdataset_type=\"embed-input\"\n\t)\n```\n\n    uploading file, starting validation...\n    sample-file-hca4x0 was uploaded\n    ...\n\n\n\n```python\nprint(ds.await_validation())\n```\n\n    cohere.Dataset {\n    \tid: sample-file-hca4x0\n    \tname: sample_file\n    \tdataset_type: embed-input\n    \tvalidation_status: validated\n    \tcreated_at: 2024-01-13 02:51:48.215973\n    \tupdated_at: 2024-01-13 02:51:48.215973\n    \tdownload_urls: ['']\n    \tvalidation_error: None\n    \tvalidation_warnings: []\n    }\n\n\n## Step 2: Create embeddings via Cohere's Embed Jobs endpoint\n\n\n```python\njob = co.create_embed_job(\n    dataset_id=ds.id,\n    input_type='search_document' ,\n    model='embed-english-v3.0', \n    embeddings_types=['float'])\n\njob.wait() # poll the server until the job is completed \n```\n\n    ...\n    ...\n\n\n\n```python\nprint(job)\n```\n\n    cohere.EmbedJob {\n    \tjob_id: 792bbc1a-561b-48c2-8a97-0c80c1914ea8\n    \tstatus: complete\n    \tcreated_at: 2024-01-13T02:53:31.879719Z\n    \tinput_dataset_id: sample-file-hca4x0\n    \toutput_urls: None\n    \tmodel: embed-english-v3.0\n    \ttruncate: RIGHT\n    \tpercent_complete: 100\n    \toutput: cohere.Dataset {\n    \tid: embeded-sample-file-drtjf9\n    \tname: embeded-sample-file\n    \tdataset_type: embed-result\n    \tvalidation_status: validated\n    \tcreated_at: 2024-01-13 02:53:33.569362\n    \tupdated_at: 2024-01-13 02:53:33.569362\n    \tdownload_urls: ['']\n    \tvalidation_error: None\n    \tvalidation_warnings: []\n    }\n    }\n\n\n## Step 3: Download and prepare the embeddings\n\n\n```python\nembeddings_file_path = 'embed_jobs_output.csv'\noutput_dataset=co.get_dataset(job.output.id)\noutput_dataset.save(filepath=embeddings_file_path, format=\"csv\")\n```\n\n\n```python\nembeddings=[]\ntexts=[]\nfor record in output_dataset:\n  embeddings.append(record['embeddings']['float'])\n  texts.append(record['text'])\n```\n\n## Step 4: Initialize Hnwslib index and add embeddings\n\n\n```python\nindex = hnswlib.Index(space='ip', dim=1024)\nindex.init_index(max_elements=len(embeddings), ef_construction=512, M=64)\nindex.add_items(embeddings,list(range(len(embeddings))))\n```\n\n## Step 5: Query the index and rerank the results\n\n\n```python\nquery = \"What was the first youtube video about?\"\n\nquery_emb=co.embed(\n    texts=[query], model=\"embed-english-v3.0\", input_type=\"search_query\"\n        ).embeddings\n\ndoc_index = index.knn_query(query_emb, k=10)[0][0]\n\ndocs_to_rerank = []\nfor index in doc_index:\n  docs_to_rerank.append(texts[index])\n\nfinal_result = co.rerank(\n    query= query,\n    documents=docs_to_rerank,\n    model=\"rerank-english-v2.0\",\n    top_n=3)\n```\n\n## Step 6: Display the results\n\n\n```python\nfor idx, r in enumerate(final_result):\n  print(f\"Document Rank: {idx + 1}, Document Index: {r.index}\")\n  print(f\"Document: {r.document['text']}\")\n  print(f\"Relevance Score: {r.relevance_score:.5f}\")\n  print(\"\\n\")\n```\n\n    Document Rank: 1, Document Index: 0\n    Document: YouTube began as a venture capital–funded technology startup. Between November 2005 and April 2006, the company raised money from various investors, with Sequoia Capital, $11.5 million, and Artis Capital Management, $8 million, being the largest two. YouTube's early headquarters were situated above a pizzeria and a Japanese restaurant in San Mateo, California. In February 2005, the company activated codice_1. The first video was uploaded April 23, 2005. Titled \"Me at the zoo\", it shows co-founder Jawed Karim at the San Diego Zoo and can still be viewed on the site. In May, the company launched a public beta and by November, a Nike ad featuring Ronaldinho became the first video to reach one million total views. The site launched officially on December 15, 2005, by which time the site was receiving 8 million views a day. Clips at the time were limited to 100 megabytes, as little as 30 seconds of footage.\n    Relevance Score: 0.94815\n    \n    \n    Document Rank: 2, Document Index: 1\n    Document: Karim said the inspiration for YouTube first came from the Super Bowl XXXVIII halftime show controversy when Janet Jackson's breast was briefly exposed by Justin Timberlake during the halftime show. Karim could not easily find video clips of the incident and the 2004 Indian Ocean Tsunami online, which led to the idea of a video-sharing site. Hurley and Chen said that the original idea for YouTube was a video version of an online dating service, and had been influenced by the website Hot or Not. They created posts on Craigslist asking attractive women to upload videos of themselves to YouTube in exchange for a $100 reward. Difficulty in finding enough dating videos led to a change of plans, with the site's founders deciding to accept uploads of any video.\n    Relevance Score: 0.91626\n    \n    \n    Document Rank: 3, Document Index: 2\n    Document: YouTube was not the first video-sharing site on the Internet; Vimeo was launched in November 2004, though that site remained a side project of its developers from CollegeHumor at the time and did not grow much, either. The week of YouTube's launch, NBC-Universal's \"Saturday Night Live\" ran a skit \"Lazy Sunday\" by The Lonely Island. Besides helping to bolster ratings and long-term viewership for \"Saturday Night Live\", \"Lazy Sunday\"'s status as an early viral video helped establish YouTube as an important website. Unofficial uploads of the skit to YouTube drew in more than five million collective views by February 2006 before they were removed when NBCUniversal requested it two months later based on copyright concerns. Despite eventually being taken down, these duplicate uploads of the skit helped popularize YouTube's reach and led to the upload of more third-party content. The site grew rapidly; in July 2006, the company announced that more than 65,000 new videos were being uploaded every day and that the site was receiving 100 million video views per day.\n    Relevance Score: 0.90665",
    "html": "",
    "htmlmode": false,
    "fullscreen": false,
    "hidden": true,
    "revision": 6,
    "_id": "664dc8ef0cae9b006d4ae1d1",
    "__v": 0,
    "createdAt": "2024-05-22T10:29:03.244Z",
    "lastUpdatedHash": "92263b38e920a36c713fa31c5a3daedba6985a1c",
    "project": "62cde2919aafea009aefb289",
    "updatedAt": "2024-07-11T01:20:27.242Z",
    "user": "5af39863989da435b05d284d"
  },
  "meta": {
    "user": {
      "allowedProjects": [
        "cohere-ai",
        "cohere-enterprise"
      ],
      "apiKey": "",
      "email": "andrewjiang@hey.com",
      "name": "Andrew Jiang",
      "version": 1,
      "Name": "Andrew Jiang",
      "Email": "andrewjiang@hey.com",
      "APIKey": "",
      "AllowedProjects": [
        "cohere-ai",
        "cohere-enterprise"
      ]
    },
    "baseUrl": "/",
    "hidden": true,
    "title": "Semantic Search with Cohere Embed Jobs",
    "metaTitle": "Semantic Search with Cohere Embed Jobs",
    "keywords": "",
    "description": "",
    "image": [],
    "slug": "embed-jobs",
    "type": "custompage",
    "full": false
  }
}